#!/usr/bin/env bash
set -euo pipefail

msg_file="$1"
first_line="$(head -n1 "$msg_file" | tr -d '\r')"

pattern='^((hotfix|fix|feature)[[:space:]]*(:|-)[[:space:]]*|issue#[0-9]+[[:space:]]*(:|-)[[:space:]]*|(close|closes|closed|fix|fixes|fixed|resolve|resolves|resolved)[[:space:]]+#?[0-9]+)'

if ! echo "$first_line" | grep -Eiq "$pattern"; then
    echo "Error: commit message must start with HOTFIX, FIX, FEATURE, ISSUE#<number>, or a GitHub closing keyword like 'Fixes #123'." >&2
    exit 1
fi

exit 0
